{% extends "base.html" %}
{% block content %}
<div class="wispy-frame">
  <div class="d-flex align-items-center mb-4">
    <img src="{{ url_for('static', filename='images/wispy.webp') }}" alt="Wispy" class="rounded-circle me-3" style="width: 80px; height: 80px;">
    <div>
      <h3 class="mb-0">Hello, {{ user.email or "Adventurer" }}!</h3>
      <p class="text-muted mb-0">Your brushstrokes await!</p>
    </div>
  </div>

  <div class="card border-0 shadow-sm mb-3">
    <div class="card-body">
      <h5 class="fw-bold">Credits Balance</h5>
      <p class="mb-1">Available: <strong>{{ credits_balance }}</strong> brushstrokes</p>
      {% if credits_balance < 5 %}
      <div class="alert alert-warning py-2 px-3 mb-2">
        <small>Low on brushstrokes! Consider purchasing more credits.</small>
      </div>
      {% endif %}

      {% if credit_grants %}
      <div class="mt-2">
        <small class="text-muted fw-bold">Credit Packages (Expires 30 days from purchase):</small>
        <ul class="list-unstyled mb-2">
          {% for grant in credit_grants[:3] %}
          <li class="small text-muted">
            ‚Ä¢ {{ grant.amount }} brushstrokes expire on {{ grant.expires_date }}
          </li>
          {% endfor %}
        </ul>
      </div>
      {% endif %}

      <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#pricingModal">
        View pricing & packages
      </button>
    </div>
  </div>

  <div class="card border-0 shadow-sm mb-3">
    <div class="card-body">
      <h5 class="fw-bold">Auto-Recharge Settings</h5>
      <p class="mb-1">
        Status:
        {% if auto_recharge_settings.enabled %}
        <span class="badge bg-success">Enabled</span>
        {% else %}
        <span class="badge bg-secondary">Disabled</span>
        {% endif %}
      </p>
      {% if auto_recharge_settings.enabled %}
      <p class="mb-2 text-muted small">
        When your balance reaches 0, we'll automatically charge ${{ "%.2f"|format(auto_recharge_settings.amount / 100) }} to add more brushstrokes.
      </p>
      {% endif %}
      <a href="{{ url_for('auto_recharge_settings') }}" class="btn btn-sm btn-outline-secondary">
        Manage Auto-Recharge
      </a>
    </div>
  </div>

  <div class="card border-0 shadow-sm mb-3">
    <div class="card-body">
      <h5 class="fw-bold">Purchase Credits</h5>
      <p class="text-muted mb-3">Buy brushstrokes to fuel your creativity! ($0.02 per brushstroke)</p>
      <div class="d-flex gap-2 flex-wrap">
        <a href="{{ url_for('buy_credits', amount=500) }}" class="btn btn-outline-primary">
          $5.00<br><small>(250 brushstrokes)</small>
        </a>
        <a href="{{ url_for('buy_credits', amount=1000) }}" class="btn btn-outline-primary">
          $10.00<br><small>(500 brushstrokes)</small>
        </a>
        <a href="{{ url_for('buy_credits', amount=2000) }}" class="btn btn-outline-primary">
          $20.00<br><small>(1,000 brushstrokes)</small>
        </a>
      </div>
    </div>
  </div>

  <div class="d-flex gap-2">
    <a href="{{ url_for('portal') }}" class="btn btn-wispy">Manage Account</a>
    <a href="{{ url_for('generate') }}" class="btn btn-outline-dark">Generate an Image</a>
  </div>
</div>

<!-- Pricing Modal -->
<div class="modal fade" id="pricingModal" tabindex="-1" aria-labelledby="pricingModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-light">
        <h5 class="modal-title" id="pricingModalLabel">Quickbrush Pricing & Brushstroke Guide</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p>
          Brushstrokes are the magical pigments that power your creations.
          Purchase credits in advance and use them whenever inspiration strikes!
        </p>

        <hr>

        <h6 class="fw-bold">‚ú® How Brushstrokes Work</h6>
        <p>
          Every image you generate costs a few brushstrokes depending on its quality:
        </p>
        <ul>
          <li><strong>1 brushstroke</strong> ‚Äî Low Quality (quick sketch)</li>
          <li><strong>3 brushstrokes</strong> ‚Äî Medium Quality (refined detail)</li>
          <li><strong>5 brushstrokes</strong> ‚Äî High Quality (fully rendered masterpiece)</li>
        </ul>

        <p class="mb-3">
          For example:
        </p>
        <ul>
          <li>With <strong>250 brushstrokes</strong>, you could create 250 quick sketches, 83 medium pieces, or 50 high-quality images.</li>
          <li>With <strong>1,000 brushstrokes</strong>, you could paint 1,000 sketches or about 333 detailed artworks!</li>
        </ul>

        <hr>

        <h6 class="fw-bold">üí∞ Credit Packages</h6>
        <p>Purchase brushstrokes in convenient packages at <strong>$0.02 per brushstroke</strong>:</p>
        <ul>
          <li><strong>$5.00</strong> ‚Äî 250 brushstrokes</li>
          <li><strong>$10.00</strong> ‚Äî 500 brushstrokes</li>
          <li><strong>$20.00</strong> ‚Äî 1,000 brushstrokes</li>
        </ul>

        <hr>

        <h6 class="fw-bold">üîÑ Auto-Recharge</h6>
        <p>
          Enable auto-recharge to automatically purchase more brushstrokes when your balance runs out.
          You can choose your preferred recharge amount ($5, $10, or $20) and disable it anytime.
        </p>

        <hr>

        <h6 class="fw-bold">‚è∞ Credit Expiration</h6>
        <p>
          All purchased credits expire <strong>30 days from the date of purchase</strong>.
          This encourages you to use your brushstrokes while they're fresh!
        </p>
        <ul>
          <li>Credits are automatically deducted from the oldest (soonest to expire) batch first</li>
          <li>You can view your credit expiration dates on the dashboard</li>
          <li>Expired credits are automatically removed and cannot be used</li>
        </ul>

        <p class="text-muted">
          <em>Think of it like a magical paint well ‚Äî refill it whenever you need, and let your imagination run wild!</em>
        </p>
      </div>
    </div>
  </div>
</div>

{% endblock %}
